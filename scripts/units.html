<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุงููุญุฏุงุช ุงูุนูุงุฑูุฉ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>๐ข ุฅุฏุงุฑุฉ ุงููุญุฏุงุช ุงูุนูุงุฑูุฉ</h1>

  <!-- ูููู ุงุฎุชูุงุฑ ุงููุฑุน + ุจูุงูุงุช ุงููุณุชุฎุฏู -->
  <div id="component"></div>

  <table id="units-table">
    <thead>
      <tr>
        <th>ุฑูู ุงููุญุฏุฉ</th>
        <th>ุงูุงุณู</th>
        <th>ุงููููุน</th>
        <th>ุงูุญุงูุฉ</th>
        <th>ุงููุณุชุฃุฌุฑ</th>
        <th>ุงููุฑุน</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="actions" style="text-align:center;">
    <a href="add-unit.html" class="btn primary">โ ุฅุถุงูุฉ ูุญุฏุฉ ุฌุฏูุฏุฉ</a>
  </div>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { fetchJSON, statusClass } from './scripts/utils.js';
    import { getSession } from './scripts/auth.js';
    import { guardButton } from './scripts/permissions.js';

    // ุชูุนูู ุงููููู ุงูููุญุฏ (ุงุฎุชูุงุฑ ุงููุฑุน + ุงูุตูุงุญูุงุช)
    initComponent("component", [
      { selector: ".btn.primary", section: "ูุญุฏุงุช", action: "ุฅุถุงูุฉ" }
    ]);

    const session = getSession();

    // ุชุญููู ุจูุงูุงุช ุงููุญุฏุงุช
    fetchJSON('data/units.json').then(units => {
      const branchUnits = units.filter(u => u.branch === session.branch);
      const tbody = document.querySelector('#units-table tbody');
      tbody.innerHTML = branchUnits.map(u => `
        <tr>
          <td>${u.id}</td>
          <td>${u.name}</td>
          <td>${u.location}</td>
          <td><span class="status ${statusClass(u.status)}">${u.status}</span></td>
          <td>${u.tenant || '-'}</td>
          <td>${u.branch || '-'}</td>
          <td>
            <a href="unit-details.html?unit=${u.id}" class="btn info">ุนุฑุถ</a>
            <button class="btn warning">ุชุนุฏูู</button>
            <button class="btn danger">ุญุฐู</button>
          </td>
        </tr>
      `).join('');

      // ุชุทุจูู ุงูุตูุงุญูุงุช ุนูู ุงูุฃุฒุฑุงุฑ
      setTimeout(() => {
        document.querySelectorAll('.btn.warning').forEach(btn =>
          guardButton(btn, session.role, 'ูุญุฏุงุช', 'ุชุนุฏูู')
        );
        document.querySelectorAll('.btn.danger').forEach(btn =>
          guardButton(btn, session.role, 'ูุญุฏุงุช', 'ุญุฐู')
        );
      }, 500);
    });
  </script>
</body>
</html>
