<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸ‘¤ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</h1>

  <!-- Ù…ÙƒÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="component"></div>

  <section id="tenant-info" class="panel">
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±...</p>
  </section>

  <div class="actions" style="margin-top:20px; text-align:center;">
    <button id="editBtn" class="btn warning">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button id="deleteBtn" class="btn danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    <a href="tenants.html" class="btn info">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†</a>
  </div>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { fetchJSON } from './scripts/utils.js';
    import { getSession } from './scripts/auth.js';
    import { guardButton } from './scripts/permissions.js';

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ­Ø¯
    initComponent("component", []);

    const params = new URLSearchParams(window.location.search);
    const tenantId = params.get("tenant");
    const session = getSession();

    async function loadTenant() {
      const tenants = await fetchJSON('data/tenants.json');
      const contracts = await fetchJSON('data/contracts.json');
      const units = await fetchJSON('data/units.json');

      const tenant = tenants.find(t => t.id === tenantId && t.branch === session.branch);
      const container = document.getElementById("tenant-info");

      if (!tenant) {
        container.innerHTML = `<p>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ø£Ùˆ Ø£Ù†Ù‡ Ù„Ø§ ÙŠØ®Øµ ÙØ±Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.</p>`;
        return;
      }

      // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ ÙˆØ§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
      const contract = contracts.find(c => c.tenantId === tenant.id && c.status === "Ø³Ø§Ø±ÙŠ");
      const unit = contract ? units.find(u => u.id === contract.unitId) : null;

      container.innerHTML = `
        <h2>${tenant.name}</h2>
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> ${tenant.id}</p>
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</strong> ${tenant.phone}</p>
        <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${tenant.email || "-"}</p>
        <p><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${tenant.branch}</p>
        <hr>
        <h3>ğŸ“‘ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
        ${contract ? `
          <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</strong> ${contract.id}</p>
          <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> ${contract.startDate}</p>
          <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</strong> ${contract.endDate}</p>
          <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø©:</strong> ${contract.amount.toLocaleString()} Ø±ÙŠØ§Ù„</p>
          <p><strong>Ø§Ù„ÙˆØ­Ø¯Ø©:</strong> ${unit ? unit.name : contract.unitId}</p>
        ` : `<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø¯ Ø³Ø§Ø±ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±.</p>`}
      `;

      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      guardButton(document.getElementById("editBtn"), session.role, "Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†", "ØªØ¹Ø¯ÙŠÙ„");
      guardButton(document.getElementById("deleteBtn"), session.role, "Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†", "Ø­Ø°Ù");
    }

    loadTenant();
  </script>
</body>
</html>
