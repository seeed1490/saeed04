<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©</h1>

  <!-- Ù…ÙƒÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="component"></div>

  <section id="unit-info" class="panel">
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©...</p>
  </section>

  <div class="actions" style="margin-top:20px; text-align:center;">
    <button id="editBtn" class="btn warning">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button id="deleteBtn" class="btn danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    <a href="units.html" class="btn info">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø¯Ø§Øª</a>
  </div>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { fetchJSON } from './scripts/utils.js';
    import { getSession } from './scripts/auth.js';
    import { guardButton } from './scripts/permissions.js';

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ­Ø¯
    initComponent("component", []);

    const params = new URLSearchParams(window.location.search);
    const unitId = params.get("unit");
    const session = getSession();

    async function loadUnit() {
      const units = await fetchJSON('data/units.json');
      const unit = units.find(u => u.id === unitId && u.branch === session.branch);

      const container = document.getElementById("unit-info");
      if (!unit) {
        container.innerHTML = `<p>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ­Ø¯Ø© Ø£Ùˆ Ø£Ù†Ù‡Ø§ Ù„Ø§ ØªØ®Øµ ÙØ±Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.</p>`;
        return;
      }

      container.innerHTML = `
        <h2>Ø§Ù„ÙˆØ­Ø¯Ø© ${unit.id}</h2>
        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${unit.name}</p>
        <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${unit.location}</p>
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${unit.status}</p>
        <p><strong>Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> ${unit.tenant || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}</p>
        <p><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${unit.branch}</p>
      `;

      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      guardButton(document.getElementById("editBtn"), session.role, "ÙˆØ­Ø¯Ø§Øª", "ØªØ¹Ø¯ÙŠÙ„");
      guardButton(document.getElementById("deleteBtn"), session.role, "ÙˆØ­Ø¯Ø§Øª", "Ø­Ø°Ù");
    }

    loadUnit();
  </script>
</body>
</html>
