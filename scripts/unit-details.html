<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تفاصيل الوحدة</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>📋 تفاصيل الوحدة</h1>

  <!-- مكون اختيار الفرع + بيانات المستخدم -->
  <div id="component"></div>

  <section id="unit-info" class="panel">
    <p>جاري تحميل بيانات الوحدة...</p>
  </section>

  <div class="actions" style="margin-top:20px; text-align:center;">
    <button id="editBtn" class="btn warning">✏️ تعديل</button>
    <button id="deleteBtn" class="btn danger">🗑️ حذف</button>
    <a href="units.html" class="btn info">🔙 رجوع للوحدات</a>
  </div>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { fetchJSON } from './scripts/utils.js';
    import { getSession } from './scripts/auth.js';
    import { guardButton } from './scripts/permissions.js';

    // تفعيل المكون الموحد
    initComponent("component", []);

    const params = new URLSearchParams(window.location.search);
    const unitId = params.get("unit");
    const session = getSession();

    async function loadUnit() {
      const units = await fetchJSON('data/units.json');
      const unit = units.find(u => u.id === unitId && u.branch === session.branch);

      const container = document.getElementById("unit-info");
      if (!unit) {
        container.innerHTML = `<p>⚠️ لم يتم العثور على الوحدة أو أنها لا تخص فرعك الحالي.</p>`;
        return;
      }

      container.innerHTML = `
        <h2>الوحدة ${unit.id}</h2>
        <p><strong>الاسم:</strong> ${unit.name}</p>
        <p><strong>الموقع:</strong> ${unit.location}</p>
        <p><strong>الحالة:</strong> ${unit.status}</p>
        <p><strong>المستأجر:</strong> ${unit.tenant || "لا يوجد"}</p>
        <p><strong>الفرع:</strong> ${unit.branch}</p>
      `;

      // تطبيق الصلاحيات على الأزرار
      guardButton(document.getElementById("editBtn"), session.role, "وحدات", "تعديل");
      guardButton(document.getElementById("deleteBtn"), session.role, "وحدات", "حذف");
    }

    loadUnit();
  </script>
</body>
</html>
