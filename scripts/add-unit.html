<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>â• Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h1>

  <!-- Ù…ÙƒÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="component"></div>

  <form id="addUnitForm" class="panel" style="max-width:500px; margin:auto;">
    <label>Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
    <input type="text" id="unitName" required><br><br>

    <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
    <input type="text" id="unitLocation" required><br><br>

    <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
    <select id="unitStatus" required>
      <option value="Ù…ØªØ§Ø­Ø©">Ù…ØªØ§Ø­Ø©</option>
      <option value="Ù…Ø¤Ø¬Ø±Ø©">Ù…Ø¤Ø¬Ø±Ø©</option>
      <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
    </select><br><br>

    <label>Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="text" id="unitTenant"><br><br>

    <button type="submit" class="btn primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙˆØ­Ø¯Ø©</button>
    <a href="units.html" class="btn info">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
  </form>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { getSession } from './scripts/auth.js';
    import { fetchJSON } from './scripts/utils.js';

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ­Ø¯
    initComponent("component", []);

    const form = document.getElementById("addUnitForm");
    const session = getSession();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const units = await fetchJSON("data/units.json");

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ø¯ÙŠØ¯ (F + Ø±Ù‚Ù…)
      const newId = "F" + (units.length + 1);

      const newUnit = {
        id: newId,
        name: document.getElementById("unitName").value,
        location: document.getElementById("unitLocation").value,
        status: document.getElementById("unitStatus").value,
        tenant: document.getElementById("unitTenant").value || null,
        branch: session.branch
      };

      // Ø­ÙØ¸ Ù…Ø¤Ù‚Øª ÙÙŠ LocalStorage (Ù…Ø­Ø§ÙƒØ§Ø©)
      const savedUnits = JSON.parse(localStorage.getItem("units") || "[]");
      savedUnits.push(newUnit);
      localStorage.setItem("units", JSON.stringify(savedUnits));

      alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!");
      window.location.href = "units.html";
    });
  </script>
</body>
</html>
