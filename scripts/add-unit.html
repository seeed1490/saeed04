<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>إضافة وحدة جديدة</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>➕ إضافة وحدة جديدة</h1>

  <!-- مكون اختيار الفرع + بيانات المستخدم -->
  <div id="component"></div>

  <form id="addUnitForm" class="panel" style="max-width:500px; margin:auto;">
    <label>اسم الوحدة:</label>
    <input type="text" id="unitName" required><br><br>

    <label>الموقع:</label>
    <input type="text" id="unitLocation" required><br><br>

    <label>الحالة:</label>
    <select id="unitStatus" required>
      <option value="متاحة">متاحة</option>
      <option value="مؤجرة">مؤجرة</option>
      <option value="صيانة">صيانة</option>
    </select><br><br>

    <label>المستأجر (اختياري):</label>
    <input type="text" id="unitTenant"><br><br>

    <button type="submit" class="btn primary">💾 حفظ الوحدة</button>
    <a href="units.html" class="btn info">🔙 رجوع</a>
  </form>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { getSession } from './scripts/auth.js';
    import { fetchJSON } from './scripts/utils.js';

    // تفعيل المكون الموحد
    initComponent("component", []);

    const form = document.getElementById("addUnitForm");
    const session = getSession();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const units = await fetchJSON("data/units.json");

      // إنشاء معرف جديد (F + رقم)
      const newId = "F" + (units.length + 1);

      const newUnit = {
        id: newId,
        name: document.getElementById("unitName").value,
        location: document.getElementById("unitLocation").value,
        status: document.getElementById("unitStatus").value,
        tenant: document.getElementById("unitTenant").value || null,
        branch: session.branch
      };

      // حفظ مؤقت في LocalStorage (محاكاة)
      const savedUnits = JSON.parse(localStorage.getItem("units") || "[]");
      savedUnits.push(newUnit);
      localStorage.setItem("units", JSON.stringify(savedUnits));

      alert("✅ تم إضافة الوحدة بنجاح!");
      window.location.href = "units.html";
    });
  </script>
</body>
</html>
