<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>

  <!-- Ù…ÙƒÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="component"></div>

  <!-- ÙÙ„Ø§ØªØ± -->
  <section class="filters panel" style="max-width:600px; margin:auto;">
    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±:</label>
    <select id="monthSelect">
      <option value="01">ÙŠÙ†Ø§ÙŠØ±</option>
      <option value="02">ÙØ¨Ø±Ø§ÙŠØ±</option>
      <option value="03">Ù…Ø§Ø±Ø³</option>
      <option value="04">Ø£Ø¨Ø±ÙŠÙ„</option>
      <option value="05">Ù…Ø§ÙŠÙˆ</option>
      <option value="06">ÙŠÙˆÙ†ÙŠÙˆ</option>
      <option value="07">ÙŠÙˆÙ„ÙŠÙˆ</option>
      <option value="08">Ø£ØºØ³Ø·Ø³</option>
      <option value="09">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
      <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
      <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
      <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
    </select>
    <button id="filterBtn" class="btn info">ğŸ” Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    <button id="printBtn" class="btn primary">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
  </section>

  <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <section id="report-results" class="panel" style="margin-top:20px;">
    <p>Ø§Ø®ØªØ± Ø´Ù‡Ø±Ù‹Ø§ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>
  </section>

  <script type="module">
    import { initComponent } from './scripts/component.js';
    import { fetchJSON } from './scripts/utils.js';
    import { getSession } from './scripts/auth.js';
    import { guardButton } from './scripts/permissions.js';

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ­Ø¯
    initComponent("component", [
      { selector: "#printBtn", section: "ØªÙ‚Ø§Ø±ÙŠØ±", action: "Ø·Ø¨Ø§Ø¹Ø©" }
    ]);

    const session = getSession();

    async function loadReport(month) {
      const data = await fetchJSON('data/reports-data.json');
      const branchData = data[session.branch] || {};
      const report = branchData[month];

      const container = document.getElementById("report-results");
      if (!report) {
        container.innerHTML = `<p>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±.</p>`;
        return;
      }

      container.innerHTML = `
        <h2>ğŸ“… ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø± ${month}</h2>
        <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</strong> ${report.revenue.toLocaleString()} Ø±ÙŠØ§Ù„</p>
        <p><strong>Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª:</strong> ${report.arrears.toLocaleString()} Ø±ÙŠØ§Ù„</p>
        <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„:</strong> ${report.occupancy}%</p>
      `;
    }

    document.getElementById("filterBtn").addEventListener("click", () => {
      const month = document.getElementById("monthSelect").value;
      loadReport(month);
    });

    document.getElementById("printBtn").addEventListener("click", () => {
      window.print();
    });
  </script>
</body>
</html>
